{% extends 'gestion_inventario/layouts/base.html' %}
{% load static %}

{% block titulo_ventana %}Lista de compartimentos{% endblock %}
{% block titulo_pagina %}Compartimentos{% endblock %}

{% block contenido %}
<div class="container py-4">
    <div class="card shadow-sm mb-3 fondo_secundario">
      <div class="card-body fondo_secundario">
        {# Small overrides when dark mode is active to style DataTables controls #}
        {% if request.session.dark_mode %}
        <style>
          /* DataTables inputs and selects */
          .dark-mode .dataTables_wrapper .dataTables_filter input,
          .dark-mode .dataTables_wrapper .dataTables_length select {
            background: #111318 !important;
            color: #e6edf3 !important;
            border-color: #2b3136 !important;
          }

          /* Pagination and info text */
          .dark-mode .dataTables_wrapper .dataTables_info,
          .dark-mode .dataTables_wrapper .dataTables_paginate {
            color: #cfd8df !important;
          }

          /* Table hover in dark mode */
          .dark-mode table.table.table-hover tbody tr:hover td {
            background-color: rgba(255,255,255,0.02) !important;
          }
        </style>
        {% endif %}
      <form id="filtros" method="get" class="row g-2 align-items-end">
        <div class="col-12 col-md-4">
          <label class="form-label fs_normal color_primario_variante">Sección</label>
          <select name="seccion" class="form-select fs_normal">
            <option value="">-- Todas --</option>
            {% for s in secciones %}
            <option value="{{ s.id }}" {% if request.GET.seccion == s.id|stringformat:'s' %}selected{% endif %}>{{ s.nombre }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-12 col-md-4">
          <label class="form-label fs_normal color_primario_variante">Nombre contiene</label>
          <input type="search" name="nombre" value="{{ request.GET.nombre|default:'' }}" class="form-control fs_normal" placeholder="Buscar por nombre">
        </div>

        <div class="col-12 col-md-2">
          <div class="form-check mt-3">
            <input class="form-check-input" type="checkbox" name="descripcion_presente" value="1" id="descpres" {% if request.GET.descripcion_presente == '1' %}checked{% endif %}>
            <label class="form-check-label color_primario_variante fs_pequena" for="descpres">Tiene descripción</label>
          </div>
        </div>

        <div class="col-12 col-md-2 text-end">
          <button type="submit" class="btn btn-primary fs_normal">Filtrar</button>
          <a href="{% url 'gestion_inventario:ruta_lista_compartimentos' %}" class="btn btn-outline-secondary fs_normal">Limpiar</a>
        </div>
      </form>
    </div>
  </div>

    <div class="card shadow-sm">
      <div class="card-body fondo_secundario color_primario_variante">
      <div class="table-responsive">
          <table id="tablaCompartimentos" class="table table-striped table-hover w-100 fs_normal {% if request.session.dark_mode %}table-dark{% endif %}">
          <thead class="">
            <tr>
                <th class="">Sección</th>
                <th class="">Compartimento</th>
                <th class="">Descripción</th>
                <th class="">Acciones</th>
            </tr>
          </thead>
          <tbody class="">
            {% for c in compartimentos %}
            <tr>
                <td class="">{{ c.seccion.nombre }}</td>
                <td class="">{{ c.nombre }}</td>
                <td class="">{{ c.descripcion|default:'-' }}</td>
                <td>
                  <a class="btn btn-sm btn-outline-primary fs_normal" href="#">Ver</a>
                  <a class="btn btn-sm btn-outline-secondary fs_normal" href="#">Editar</a>
                  <a class="btn btn-sm btn-outline-danger fs_normal" href="#">Eliminar</a>
                </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

{# Focused CSS for DataTables when using table-dark to ensure headers and controls match theme #}
{% if request.session.dark_mode %}
<style>
  /* Make DataTables header darker and text lighter */
  table.table-dark thead th {
    background-color: #0d1112 !important;
    color: #e6edf3 !important;
    border-bottom: 1px solid rgba(255,255,255,0.06) !important;
  }

  table.table-dark tbody td {
    color: #cfd8df !important;
  }

  /* Override DataTables length/search controls background */
  .table-dark .dataTables_wrapper .dataTables_filter input,
  .table-dark .dataTables_wrapper .dataTables_length select {
    background: #0b0d0e !important;
    color: #e6edf3 !important;
    border-color: rgba(255,255,255,0.06) !important;
  }

  /* Pagination buttons */
  .dataTables_wrapper .dataTables_paginate .paginate_button {
    color: #cfd8df !important;
  }

</style>
{% endif %}

{% block scripts %}
{{ block.super }}
<script>
  // Inicializar DataTables con búsqueda y opciones avanzadas
  document.addEventListener('DOMContentLoaded', function(){
    if(window.jQuery && $.fn.dataTable){
      $('#tablaCompartimentos').DataTable({
        responsive: true,
        pageLength: 25,
        dom: "<'row'<'col-sm-6'l><'col-sm-6'f>>" +
             "<'row'<'col-sm-12'tr>>" +
             "<'row'<'col-sm-5'i><'col-sm-7'p>>",
        language: {
          url: 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
        },
      });
    }
  });
</script>
{% endblock %}
{% endblock %}